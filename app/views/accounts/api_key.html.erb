<%= render 'accounts/header' %>

<div class="container">
  <div class="row">
    <div class="col-12 col-lg-3">
      <%= render 'accounts/navigation' %>
    </div>
    <div class="col-12 col-lg-9">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">API Keys</h1>
        <%= button_to 'Create new key', create_api_key_account_path, method: :post, class: 'btn btn-primary rounded-pill' %>
      </div>

      <% if @api_keys.any? %>
        <% @api_keys.each do |api_key| %>
          <div class="well p-3 mb-3">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div class="flex-grow-1">
                <h2 class="h5 mb-1"><%= api_key.name %></h2>
                <p class="text-muted small mb-2">
                  Created <%= api_key.created_at.strftime('%B %d, %Y') %>
                  <% if api_key.last_used_at %>
                    • Last used <%= time_ago_in_words(api_key.last_used_at) %> ago
                  <% else %>
                    • Never used
                  <% end %>
                </p>
              </div>
              <%= button_to 'Revoke', revoke_api_key_account_path(api_key_id: api_key.id), method: :delete, class: 'btn btn-sm btn-outline-danger', data: { confirm: 'Are you sure you want to revoke this API key?' } %>
            </div>
            <div class="input-group">
              <input type="text" class="form-control font-monospace" value="<%= api_key.key_prefix %>••••••••••••••••••••••••" readonly>
              <button class="btn btn-outline-secondary" type="button" onclick="alert('Copy functionality would be implemented here')">
                <%= bootstrap_icon 'copy', width: 12, height: 12, aria_hidden: 'true', focusable: 'false', role: 'img', class: 'me-1' %> Copy
              </button>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="well p-4 text-center">
          <p class="text-muted mb-3">You don't have any API keys yet.</p>
          <%= button_to 'Create your first API key', create_api_key_account_path, method: :post, class: 'btn btn-primary rounded-pill' %>
        </div>
      <% end %>

      <div class="alert alert-info mt-4" role="alert">
        <h3 class="h6">About API Keys</h3>
        <p class="small mb-0">
          Your API key is how we manage your rate limits. Sharing your API key is against our terms of service and will result in throttling.
          If you think your API key has been shared, create a new one and revoke the compromised key.
        </p>
      </div>
    </div>
  </div>
</div>
